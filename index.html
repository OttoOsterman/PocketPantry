<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="normalize.css">
    <!--Icons for social media buttons-->
    <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css'>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket Pantry</title>
    <!--jQuery for navigation bar sticky scroll function-->
    <script type="text/javascript" src="//code.jquery.com/jquery-latest.js"></script>
    <!--include the Google Platform Library for Google sign-in-->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id"
          content="568823689660-386ik3kjs8gbu26p6l9i9eveoa5fk0c2.apps.googleusercontent.com">
    <meta property="og:url"           content="http://pocketpantry.azurewebsites.net" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Pocket Pantry" />
    <meta property="og:description"   content="Search recipes!" />
    <meta property="og:image"         content="MaterialPantry.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.0.1/jquery.rateyo.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.0.1/jquery.rateyo.min.js"></script>
</head>
<body>
<!-- The Popup -->
<section id="myPopup" class="popup">

    <!-- Popup content -->
    <section class="popup-content">
        <span class="close">X</span>
        <!--Login button-->
        <a class="g-signin2" data-onsuccess="onSignIn" onclick="login1()"></a>
        <script>
            //Login function
            function login1() {
                if ($('.login').text('Login')) {
                    $('.login').text('Logout')
                }
            }
        </script>
        <!--Facebook stuff-->
        <section id="fb-root"></section>
        <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
        <section class="fb-login-button" data-max-rows="1" data-size="xlarge" data-show-faces="false" data-auto-logout-link="true"></section>

        <!--Logout button-->
        <a href="#" class="logout" onclick="logout1()">Logout</a>
        <script>
            //Signout function
            function signOut2() {
                FB.logout();
                // user is now logged out of Facebook
                console.log('User signed out of Facebook');
            }
        </script>
        <script>
            function signOut1() {
                var auth2 = gapi.auth2.getAuthInstance();
                auth2.signOut().then(function () {
                    // user is now logged out of Google+
                    console.log('User signed out of Google+.');
                });
            }
        </script>
        <script>
            //            Logout function
            function logout1() {
                signOut1();
                signOut2();
                $('.login').text('Login')
            }
        </script>
    </section>

</section>
<section id="top">
    <!--Logo and header-->
    <header id="MainHeader">
        <h1 id="Title">Pocket <img src="MaterialPantry.png" id="MaterialPantry" alt="PocketPantryLogo"
                                   height="200" width="200" align="center"> Pantry</h1>
        <!--Navigation bar-->
        <nav id="nav">
            <ul>
                <li class="left"><a href="#top" id="home" tabindex="1">Home</a></li>
                <li><a href="#aboutUs" class="about" tabindex="2">About</a></li>
                <li><a href="#getInTouch" class="contact" tabindex="3">Contact</a></li>


                <!--Login button-->
                <li><a href="#signlogin" id="loginBtn" class="login">Login</a></li>
                <li class="right">

                    <input type="searchBox" id="recipeSearch" name="search" placeholder="Search recipes">

                </li>

            </ul>
            <br class="clearLeft"/>
        </nav>
        <section id="nav-trigger">
            <span id="Title2">Pocket Pantry</span>
        </section>
        <nav id="nav-mobile"></nav>
        <a id="upBtn" href="#top"><img src="MaterialPantry.png" id="MaterialPantry2" alt="PocketPantryLogo"
                                       height="60" width="60" align="center"></a>

    </header>
    <!--Make navigation bar sticky when user scrolls past it.
     One for desktop view and one for mobile view-->

    <section class="row1">
        <!--Left bar-->
        <nav id="LeftBar">
            <ul id="AddIngs">
                <a id="whatsinyourpantry">What's In Your Pantry?</a>
                <section class="my-form">
                    <form role="form" method="post">
                        <p class="text-box">
                            <label for="box1"><span class="box-number">1</span></label>
                            <input type="ingredient" name="boxes[]" value="" id="box1"/>
                        </p>
                        <a class="add-box" href="#">
                            <button class="button addbutton">Add</button>
                        </a>
                        <button class="button searchbutton" id="searchb" type="button">Search</button>
                    </form>
                </section>
                <!--Add, remove and search button functions-->
                <script type="text/javascript">
                    jQuery(document).ready(function ($) {
                        //Function to return box contents
                        function getSearchBox() {
                            var userInput = "";
                            $(".text-box input").each(function () {
                                        userInput += $(this).val() + ',';
                                    }
                            );
                            return userInput;
                        }
                        function getOtherSearchBox() {
                            var userInput = $('#recipeSearch').val();
                            return userInput;
                        }
                        //Run ingredient search
                        $("#searchb").click(function () {
                            console.log("clicked");
                            $('.ResultArea').empty();
                            searchApi(getSearchBox());
                        });
                        //Run general search
                        $("#recipeSearch").keypress(function (e) {
                            if(e.which==13){
                                console.log("entered");
                                $('.ResultArea').empty();
                                searchApi(getOtherSearchBox());
                            }
                        });
                        createCard('Placeholder', 'by Andrew Maclean', 'http://static.food2fork.com/Buffalo2BChicken2BGrilled2BCheese2BSandwich2B5002B4983f2702fe4.jpg','www.google.co.uk','3.5');
                        createCard('Placeholder', 'by Andrew Maclean', 'http://static.food2fork.com/Buffalo2BChicken2BGrilled2BCheese2BSandwich2B5002B4983f2702fe4.jpg','www.google.co.uk','3.5');
                        createCard('Placeholder', 'by Andrew Maclean', 'http://static.food2fork.com/Buffalo2BChicken2BGrilled2BCheese2BSandwich2B5002B4983f2702fe4.jpg','www.google.co.uk','3.5');
                        //searchApi(getSearchBox());
                        function searchApi(search){
                            // WORKING
                            $.ajax({
                                url: "http://pocketpantry.azurewebsites.net/theprox.php?url=http://food2fork.com/api/search",
                                type: "GET",
                                data: {key: "e3be4f880ddb28c4772c0a42ac6180a5", q: search.slice(0,-1)},
                                dataType: "json",
                                success: function (response) {
                                    console.log(response);
                                    var res = JSON.parse(JSON.stringify(response));
                                    console.log(res.recipes[0].title);
                                    for (i = 0; i < res.recipes.length; i++) {
                                        // createCard(res.recipes[i].title, res.recipes[i].image_url, res.recipes[i].source_url);
                                        console.log(res.recipes[i].title);
                                        var recipeTitle = res.recipes[i].title;
                                        var publisher = "by " + res.recipes[i].publisher;
                                        var imgSrc = res.recipes[i].image_url;
                                        var rating = (res.recipes[i].social_rank)/20;
                                        var recSrc = "";
                                        createCard(recipeTitle, publisher, imgSrc, recSrc, rating);
                                    }
                                }
                                ,
                                error: function (xhr, status) {
                                    alert("error");
                                }
                            });
                        }
                        //end function
                    });
                </script>
            </ul>
        </nav>
        <!--Right side of the screen where results are shown-->
        <section class="ResultArea">

        </section>

        <script>
            //Function that will create and populate a recipe card
            function createCard(desc, publisher, imgSrc, recipeSrc, rating) {
                var resultCard = $('<div class="results"></div>');
                var descWrapper = $('<div class="descWrapper"></div>');
                var description = $('<div class="desc"></div>').text(desc).attr('href', recipeSrc);
                var publisher = $('<div class="publisher"></div>').text(publisher);
                var heart1 = $('<div class="heart1"></div>');
                var imgOuter = $('<div class="imgOuter"></div>');
                var imgInner = $('<div class="imgInner"></div>');
                //var blank = $('<a class="_blank"></a>').attr('href', recipeSrc);
                var image = $('<img />').attr('src', imgSrc).attr('alt', desc).attr('href', recipeSrc);
                var resultInformation = $('<div class="resultInformation"></div>');
                var soRank = $('<div class="soRank"></div>').text("Social Rank : ");
                var rateYo = $('<div class="rateYo" id="rateYo"></div>');
                var resultIngs = $('<div class="resultIngs"></div>');

                $(resultCard).append(descWrapper);
                $(descWrapper).append(description);
                $(description).append(publisher);
                $(descWrapper).append(heart1);
                $(heart1).prepend('<img src="heartIcon3.png" class="heart3" alt="heart" />');
                $(descWrapper).append(imgOuter);
                $(imgOuter).append(imgInner);

                $(imgInner).prepend(image);
                $(image).wrap($('<a>',{

                    href: recipeSrc,
                    target: '_blank'
                }));
                $(descWrapper).append(resultInformation);
                $(resultInformation).append(soRank);
                $(resultInformation).append(rateYo);
                $(rateYo).rateYo({rating:rating, ratedFill: "#FF6138", readOnly: true});
                $(resultInformation).append(resultIngs);
                $(resultIngs).prepend('<a class="ings">Social Rank</a>').prepend('<a class="ings">+ Magic Beans</a>').prepend('<a class="ings">- Beer</a>').prepend('<a class="ings">- Skills</a>');
                $(resultCard).appendTo($('.ResultArea'));
            }
        </script>

    </section>
    <!--Footer-->
    <footer id="PageFooter">
        <section id="getInTouch">
            <section id="getInTouchBox">
                <a id="geta classHeader">Get In Touch</a><br>
                <a></a><br>
                <a>info@pocketpantry.co.uk</a><br>
                <a>01224 242399</a><br>
                <a></a><br>
                <a>333 Pantry Way</a><br>
                <a>Aberdeen</a><br>
                <a>AB10 L0L</a>
            </section>
        </section>
        <section id="aboutUs">
            <section id="aboutUsBox">
                <a id="aboutUsHeader">About Us</a><br>
                <a></a><br>
                <a>Pocket Pantry; a web app that allows</a><br>
                <a>you to enter the food that you have in</a><br>
                <a>your fridge/cupboards and it will suggest</a><br>
                <a>recipes to make with what you have.</a>
            </section>
            <section class="fb-like"
                     data-href="http://pocketpantry.azurewebsites.net"
                     data-layout="button_count"
                     data-action="like"
                     data-show-faces="true"
                     data-colorscheme="dark"
                     data-share="true">
            </section>
        </section>
        <!--Buttons for social media-->
        <section id="socialButtons">
            <a href="https://www.facebook.com/profile.php?id=563989053776695&ref=ts&fref=ts" class="icon-link facebook"><i
                    class="fa fa-facebook"></i></a>
            <a href="https://twitter.com/PocketPantryApp" class="icon-link twitter"><i class="fa fa-twitter"></i></a>
            <a class="icon-link google-plus"><i class="fa fa-google-plus"></i></a><br>
            <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="icon-link youtube"><i
                    class="fa fa-youtube"></i></a>
            <a href="https://www.instagram.com/pocketpantry/" class="icon-link pinterest"><i
                    class="fa fa-pinterest"></i></a>
            <a class="icon-link tumblr"><i class="fa fa-tumblr"></i></a>
        </section>
    </footer>

    <!------------------------- Scripts ---------------------------->
    <script type="text/javascript">
        $(document).ready(function () {
            <!-- Responsive nav bar script -->
            if ($(window).width() < 700) {
                $("#upBtn").css({visibility: 'visible'});
                $("#nav").hide();
                $("#MainHeader").toggleClass("toggle");
                $("#nav-mobile").html($("#nav").html());
                $("#Title2").click(function () {
                    if ($("nav#nav-mobile ul").hasClass("expanded")) {
                        $("nav#nav-mobile ul.expanded").removeClass("expanded").slideUp(350);
                        $(this).removeClass("open");
                    } else {
                        $("nav#nav-mobile ul").addClass("expanded").slideDown(350);
                        $(this).addClass("open");
                    }
                });
                //$(document).ready(function () {
                $(window).scroll(function () {
                    console.log($(window).scrollTop());
                    if ($(window).scrollTop() > 25) {
                        $("#nav-trigger").css({width: '100%', marginTop: 0, top: 0, position: 'fixed'});
                        $("#nav-mobile").css({width: '100%', marginTop: 0, top: 0, position: 'fixed'});
                        $("nav#nav-mobile ul.expanded").css({marginTop: '65px'});
                    }
                });
                //});
            } else {
                //$(document).ready(function () {
                $(window).scroll(function () {
                    if ($(window).scrollTop() > 33) {
                        $("#nav").css({
                            top: 0,
                            position: 'fixed',
                            width: '100%',
                            marginLeft: '0',
                            marginRight: '0',
                            left: '0'
                        });
                    }
                    $(window).scroll(function () {
                        if ($(window).scrollTop() > 331) {
                            $("#LeftBar").css({position: 'fixed'});
                        }});
                    if ($(window).scrollTop() < 331) {
                        $("#nav").css({position: "static", marginLeft: '15%', marginRight: '15%', width: '70%'});
                        $("#LeftBar").css({position: 'static', top: '175px'});
                    }
                });
                //});
            }
            <!-- End of Responsive nav bar script -->
            <!-- Add/remove new ingredient box script -->
            $('.my-form .add-box').click(function () {
                var n = $('.text-box').length + 1;
                var box_html = $('<p class="text-box"><label for="box' + n + '"><span class="box-number">'
                        + n + '</span></label> <input type="ingredient" name="boxes[]" value="" id="box'
                        + n + '" /> <a href="#" class="remove-box"><button class="button deletebutton">X</button></a></p>');
                box_html.hide();
                $('.my-form p.text-box:last').after(box_html);
                box_html.fadeIn('slow');
                return false;
            });
            $('.my-form').on('click', '.remove-box', function () {
                $(this).parent().fadeOut("slow", function () {
                    $(this).remove();
                    $('.box-number').each(function (index) {
                        $(this).text(index + 1);
                    });
                });
                return false;
            });
            <!-- end of add/remove new ingredient box script -->
            function getSearchBox() {
                var userInput = "";
                $(".text-box input").each(function () {
                            userInput += $(this).val() + ',';
                        }
                );
                return userInput;
            }
            <!-- This shit *used to* work-->
            function search() {
                var baseURL = "http://food2fork.com/api/search?key=c374bfbac65d543206653a9fe750799d&q=eggs&callback=?";
                /* $.getJSON(baseURL)
                 .success(function( data ) {
                 console.log("success: " +data);
                 })
                 .done(function( data ) {
                 console.log("done: " +data);
                 })
                 .error(function(error) {
                 console.log("error: " +error);
                 });*/
//                $.ajax({url: baseURL,
//                    success: function(jsondata){
//                        console.log(
//                                jsondata);
//                    }, error: function(xhr, status, error) {
//                        console.log("error");
//                        console.log(xhr);
//                        console.log(status);
//                        console.log(error);
//
//                    }
//                });
            }
            <!-- End of this Shit Works -->
            //Function declaration
            //$(document).ready(function () {
            $('a[href^="#"]').on('click', function (e) {
                e.preventDefault();
                var target = this.hash;
                var $target = $(target);
                $('html, body').stop().animate({
                    'scrollTop': $target.offset().top
                }, 900, 'swing');
            });
            //});
            <!--Blur background when login button is clicked-->
            function Blur() {
                $('#Title, #PageContent, .results, #LeftBar, #PageFooter, #MainHeader').css({
                    'filter': 'blur(2px)',
                    '-webkit-filter': 'blur(2px)',
                    '-moz-filter': 'blur(2px)',
                    '-o-filter': 'blur(2px)',
                    '-ms-filter': 'blur(2px)',
                    transition: 'all 0.3s ease-in-out'
                })
            }
            <!--unblur background when popup is closed-->
            function unBlur() {
                $(' #Title, .results, #PageContent, #LeftBar, #PageFooter,#MainHeader').css({
                    'z-index': 900,
                    'filter': 'blur(0px)',
                    '-webkit-filter': 'blur(0px)',
                    '-moz-filter': 'blur(0px)',
                    '-o-filter': 'blur(0px)',
                    '-ms-filter': 'blur(0px)',
                    transition: 'all 0.3s ease-in-out'
                });
                $('#nav').css('z-index', 9999);
            }
            <!-- Popup Script -->
            // Get the popup
            var popup = document.getElementById('myPopup');
            // Get the button that opens the popup
            var a = document.getElementById("loginBtn");
            // Get the <span> element that closes the popup
            var span = document.getElementsByClassName("close")[0];
            // When the user clicks on the button, open the popup
            a.onclick = function () {
                popup.style.display = "block";
                Blur();
            };
            // When the user clicks on <span> (x), close the popup
            span.onclick = function () {
                popup.style.display = "none";
                unBlur();
            };
            // When the user clicks anywhere outside of the popup, close it
            window.onclick = function (event) {
                if (event.target == popup) {
                    popup.style.display = "none";
                    unBlur();
                }
            };
            <!-- End of popup script -->
            <!-- Google Script -->
            function onSuccess(googleUser) {
                console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
            }
            function onFailure(error) {
                console.log(error);
            }
            function renderButton() {
                gapi.signin2.render('g-signin2', {
                    'scope': 'profile email',
                    'width': 240,
                    'height': 50,
                    'longtitle': true,
                    'theme': 'dark',
                    'onsuccess': onSuccess,
                    'onfailure': onFailure
                });
            }});
        <!-- End of Google script -->
        <!-- Facebook Script -->
        //First Part
        // This is called with the results from from FB.getLoginStatus().
        function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            // The response object is returned with a status field that lets the
            // app know the current login status of the person.
            // Full docs on the response object can be found in the documentation
            // for FB.getLoginStatus().
            if (response.status === 'connected') {
                // Logged into your app and Facebook.
                testAPI();
            } else if (response.status === 'not_authorized') {
                // The person is logged into Facebook, but not your app.
                document.getElementById('status').innerHTML = 'Please log ' +
                        'into this app.';
            } else {
                // The person is not logged into Facebook, so we're not sure if
                // they are logged into this app or not.
                document.getElementById('status').innerHTML = 'Please log ' +
                        'into Facebook.';
            }
        }
        // This function is called when someone finishes with the Login
        // Button.  See the onlogin handler attached to it in the sample
        // code below.
        function checkLoginState() {
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        }
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '985300261517338',
                cookie     : true,  // enable cookies to allow the server to access
                                    // the session
                xfbml      : true,  // parse social plugins on this page
                version    : 'v2.6' // use graph api version 2.6
            });
            // Now that we've initialized the JavaScript SDK, we call
            // FB.getLoginStatus().  This function gets the state of the
            // person visiting this page and can return one of three states to
            // the callback you provide.  They can be:
            //
            // 1. Logged into your app ('connected')
            // 2. Logged into Facebook, but not your app ('not_authorized')
            // 3. Not logged into Facebook and can't tell if they are logged into
            //    your app or not.
            //
            // These three cases are handled in the callback function.
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        };
        // Load the SDK asynchronously
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        // Here we run a very simple test of the Graph API after login is
        // successful.  See statusChangeCallback() for when this call is made.
        function testAPI() {
            console.log('Welcome!  Fetching your information.... ');
            FB.api('/me', function(response) {
                console.log('Successful login for: ' + response.name);
                document.getElementById('status').innerHTML =
                        'Thanks for logging in, ' + response.name + '!';
            });
        }
        <!-- End of Facebook Script -->
    </script>

</section>
</body>
</html>